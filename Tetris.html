<canvas id='canvas_id' height="500" width="500"></canvas>
<script>
    var canvas = document.getElementById('canvas_id')
    var ctx = canvas.getContext('2d')
    const side = 20, rows = 10, colums = 20
    var field=[[]]
    var figure = [[]]

    function SetMatrix(matrix, value){
        for(var row_index = 0; row_index < rows; row_index++){
            matrix[row_index] = new Array();
            for(var col_index = 0; col_index < colums; col_index++)
                matrix[row_index][col_index] = value
        }
    }

    function AddFigureToField(){
      for(var row_index = 0; row_index < rows; row_index++)
          for(var col_index = 0; col_index < colums; col_index++)
              field[row_index][col_index] = figure[row_index][col_index]
    }

    function Draw(){
        ctx.fillStyle = "#000000"
        for(var row_index = 0; row_index < rows; row_index++)
            for(var col_index = 0; col_index < colums; col_index++)
                if(field[row_index][col_index])
                    ctx.fillRect(row_index*side, col_index*side, side, side)
    }

    function MoveDown(){
        for(var row_index = rows - 1; row_index >= 0; row_index--){
            for(var col_index = colums - 1; col_index >= 0; col_index--){
                if(field[row_index][col_index] && (col_index == colums-1 || field[row_index][col_index+1])){
                    col_index = colums-1;
                    row_index = rows-1;
                } else if(field[row_index][col_index] && (col_index+1 < colums && !field[row_index][col_index+1])){
                    field[row_index][col_index+1]=true;
                    field[row_index][col_index]=false;
                }
            }
        }
    }

    function MoveRight(){
        for(var row_index = rows - 1; row_index >= 0; row_index--){
            for(var col_index = colums - 1; col_index >= 0; col_index--){
                if(field[row_index][col_index] && (row_index == rows-1 && field[row_index+1][col_index])){

                } else if(field[row_index][col_index] && (row_index+1 < rows && !field[row_index+1][col_index])){//} && !(row_index == rows-1 && field[row_index+1][col_index])){
                    field[row_index+1][col_index]=true;
                    field[row_index][col_index]=false;
                }
            }
        }
    }

    function MoveLeft(){
      for(var row_index = 0; row_index < rows; row_index++)
          for(var col_index = 0; col_index < colums; col_index++)
              if(field[row_index][col_index] && (row_index == 0 && field[row_index-1][col_index])){

              } else if(field[row_index][col_index] && (row_index-1 >= 0 && !field[row_index-1][col_index])){
                  field[row_index-1][col_index]=true;
                  field[row_index][col_index]=false;
              }
    }

    SetMatrix(field,false)
    SetMatrix(figure, false)//when figure is stop, then AddFigureToField and generate new figure
    figure[5][1]=true
    figure[6][1]=true
    figure[5][2]=true
    figure[5][3]=true
    Draw()
    document.addEventListener("keydown", function(event) {
        console.log(event.which);
        var keycode = (event.keyCode ? event.keyCode : event.which);
        if(event.which == 39){
            MoveRight()
            ctx.clearRect(0,0,rows*side,colums*side)
            Draw()
        }
        if(event.which == 37){
            MoveLeft()
            ctx.clearRect(0,0,rows*side,colums*side)
            Draw()
        }
    });

    setInterval(function(){
        MoveDown()
        ctx.clearRect(0,0,rows*side,colums*side)
        Draw()
    },500)

</script>
